<!-- Default box -->
<div class="box box-primary">
    <div class="box-header with-border">
        <h1><span class="fa  fa-ellipsis-v"></span> Gesti&oacute;n Compras </h1>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-3 padding-top-sm">
                <label class="col-xs-5 control-label">Fecha Inicio</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control input-sm fecha" id="fini" name="fini">
                </div>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-3 padding-top-sm padding-bottom-sm">
                <label class="col-xs-5 control-label">Fecha Fin</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control input-sm fecha" id="ffin" name="ffin">
                </div>
            </div>
            <div class="col-md-3">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-primary active usuarioRadio">
                        <input type="radio" name="usuario" value="true" title="Compras Propias" checked> C. Propias
                    </label>
                    <label class="btn btn-success usuarioRadio" title="Compras generales">
                        <input type="radio" name="usuario" value="false"> C. Generales
                    </label>
                </div>
            </div>
            <div class="col-md-3">
                <div class="btn-group btn-group-justified padding-top-sm">
                    <label class="btn btn-primary active estadoRadio">
                        <input type="radio" name="estado" value="true" title="Mostrar Activos" checked> Activos
                    </label>
                    <label class="btn btn-danger estadoRadio" title="Mostrar Inactivos">
                        <input type="radio" name="estado" value="false"> Inactivos
                    </label>
                </div>
            </div>
        </div>
    </div>
    <div class="box-body">

        <table id="tabla" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="all">C&oacute;digo<br>compra</th>
                    <th class="all">Fecha</th>
                    <th class="desktop">Proveedor</th>
                    <th class="none">Usuario</th>
                    <th class="none">Observaci&oacute;n</th>
                    <th class="desktop">Subtotal</th>
                    <th class="desktop">Descuento</th>
                    <th class="desktop">Total</th>
                    <th class="all">Acciones</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
    <!-- /.box-body -->
</div>
<!-- /.box -->
<script>
    $(document).ready(function() {
        $(".fecha").inputmask("dd/mm/yyyy", {
            "placeholder": "dd/mm/yyyy"
        });
        $('#tabla').dataTable({
            buttons: [{
                text: 'Adicionar',
                className: "btn-primary btn-block active",
                action: function(e, dt, node, config) {
                    $.post('../compra/adicionar?isMobil='+UtilBrowser.isMobil(), function(resp) {
                        $('#contenedor').html(resp);
                    });
                }
            }],
            "ajax": {
                "type": "POST",
                "url": "../compra/lista",
                "data": function(d) {
                    d.estado = $('input[name=estado]:checked').val();
                    d.fini = $('#fini').val();
                    d.ffin = $('#ffin').val();
                    d.usuario = $('input[name=usuario]:checked').val();
                }
            },
            "columnDefs":[{targets: [5,6,7,8],className:'text-right'}],
            "columns": [{
                "data": "cod_com"
            }, {
                "data": "fecha"
            }, {
                "data": "proveedor"
            }, {
                "data": "usuario"
            }, {
                "data": "obs_com"
            }, {
                "data": "subtotCom"
            }, {
                "data": "des_com"
            }, {
                "data": "tot_com"
            }, {
                "data": "cod_com"
            }],
            "createdRow": function(row, data, index) {
                if ($('input[name=estado]:checked').val() == 'true') {
                    let buttons = '<button class="btn btn-success imprimir"  data-toggle="tooltip" data-placement="top" title="Imprimir" data-id="' + data.cod_com + '"><i class="glyphicon glyphicon-print"></i><br>imprimir</button>';
                    buttons += '<button class="btn btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="' + data.cod_com + '"><i class="glyphicon glyphicon-remove"></i><br>borrar</button>';
                    $('td', row).eq(8).html('<div class="btn-group btn-group-xs">'+buttons+'</div>');
                } else
                    $('td', row).eq(8).html('<button class="btn btn-success imprimir" data-id="' + data.cod_com + '" data-toggle="tooltip" data-placement="top" title="Imprimir"><i class="glyphicon glyphicon-print"></i>  </button>');
            },
            "drawCallback": function(settings) {
                $('.eliminar').click(function() {
                    let xcod = $(this).data('id');
                    alertEliminacion('Confirmar eliminacion de compra', 'Esta seguro de eliminar la compra: '+xcod, function(){
                    	$.post('../compra/eliminar', {'cod_com':xcod}, function(result) {
                            if (result.status == true) {
                                xform.data('formValidation').resetForm();
                                $('.modal').modal('hide');
                                $('#tabla').dataTable().fnDraw('page');
                                mostrarMensaje('info', 'Se realizo con exito la Transaccion');
                            } else {
                                mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                            }
                        }, 'json');
                    });
                });
                $('.imprimir').click(function() {
                	abrirLoad();
                    $("#frameReportes").attr("src", "../compra/ver?cod_com=" + $(this).data('id'));
                    cerrarLoad();
                    $("#reportes").modal('show');
                });
                $('button[data-toggle="tooltip"]').tooltip({
                    animated: 'fade',
                    placement: 'bottom',
                });

            }
        });
        $('.estadoRadio').click(function() {
            $('#tabla').dataTable().fnDraw('page');
        });
        $('.usuarioRadio').click(function() {
            $('#tabla').dataTable().fnDraw('page');
        });

        function isDate(cad) {
            var d = new Date(cad.substring(3, 5) + '/' + cad.substring(0, 2) + '/' + cad.substring(6, 10));
            return !isNaN(d.valueOf());
        }
        $('#fini').keyup(function() {
            if (isDate($('#fini').val()))
                $('#tabla').dataTable().fnDraw('page');
        });
        $('#ffin').keyup(function() {
            if (isDate($('#ffin').val()))
                $('#tabla').dataTable().fnDraw('page');
        });
    });
</script>