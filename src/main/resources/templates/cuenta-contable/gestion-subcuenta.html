<form id="formulario" method="post" action="../cuenta/guardarSubcuenta" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
            <div id="modalAdicionar" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">Adicionar Subcuenta</h4>
                        </div>
                        <div class="modal-body">
                        	<input type="hidden" id="codCuenta" name="codCuenta" />
                            <div class="form-group">
                                <label>C&oacute;digo</label>
                                <input type="text" class="form-control" id="codigo" name="codigo" data-fv-notempty="true">
                            </div>
                            <div class="form-group">
                                <label>Nombre</label>
                                <input type="text" class="form-control text-uppercase" id="nombre" name="nombre" data-fv-notempty="true">
                            </div>
                            <div class="form-group">
                            	<label>Es visible externamente</label>
                            	<div class="radio">
                            		<label for="externoSi"><input type="radio" id="externoSi" name="esExterno" value="true" data-fv-notempty="true"/>Si</label>
                            		<label for="externoNo"><input type="radio"  id="externoNo" name="esExterno" value="false" data-fv-notempty="true"/>No</label>
                            	</div>
                            </div>
                            <div class="form-group">
                                <label>Descripci&oacute;n</label>
                                <textarea name="descripcion" id="descripcion" class="form-control"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-social btn-google" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                            <button type="submit" class="btn btn-social btn-bitbucket"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
<form id="formularioModificar" method="post" action="../cuenta/actualizarSubcuenta" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
            <div id="modalModificar" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">Modificar Subcuenta</h4>
                        </div>
                        <div class="modal-body">
                        	<input type="hidden" id="codCuenta2" name="codCuenta" />
                        	<input type="hidden" id="codCuenta2" name="codSubcuenta" />
                            <div class="form-group">
                                <label>C&oacute;digo</label>
                                <input type="text" class="form-control" id="codigo2" name="codigo" data-fv-notempty="true">
                            </div>
                            <div class="form-group">
                                <label>Nombre</label>
                                <input type="text" class="form-control text-uppercase" id="nombre2" name="nombre" data-fv-notempty="true">
                            </div>
                            <div class="form-group">
                            	<label>Es visible externamente</label>
                            	<div class="radio">
                            		<label for="externoSi2"><input type="radio" id="externoSi2" name="esExterno" value="true" data-fv-notempty="true"/>Si</label>
                            		<label for="externoNo2"><input type="radio"  id="externoNo2" name="esExterno" value="false" data-fv-notempty="true"/>No</label>
                            	</div>
                            </div>
                            <div class="form-group">
                                <label>Descripci&oacute;n</label>
                                <textarea name="descripcion" id="descripcion2" class="form-control"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-social btn-google" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                            <button type="submit" class="btn btn-social btn-bitbucket"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
<div class="box box-primary">
    <div class="box-header with-border">
        <div class="box-tools pull-right">
            <button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="fa fa-minus"></i></button>
            <button class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove"><i class="fa fa-times"></i></button>
        </div>
    </div>
    <div class="box-body">
        <div class="row">
            <div class="col-md-8">
                <h1><span class="fa  fa-ellipsis-v"></span> Cuenta Contable: $!{cuenta.nombre}</h1>
            </div>
            <div class="col-md-4">
            <button class="btn btn-primary" id="btnAdicionar"><i class="fa fa-plus"></i> | adicionar</button>
            <button class="btn btn-danger" id="btnAtras"><i class="fa fa-arrow-left"></i> | volver atras</button>
            </div>
        </div>
        <table id="tabla" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>C&oacute;digo</th>
                    <th>Nombre</th>
                    <th>Descripci&oacute;n</th>
                    <th>Tipo</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <!-- /.box-body -->
</div>
<!-- /.box -->
<script>
    $(document).ready(function() {
        $('#btnAtras').click(function(){
        	$.get('../cuenta/gestion',function(resp){
        		$('#contenedor').html(resp);
        	})
        });
        $('#tabla').dataTable({
            dom: "<'row'<'col-sm-3'f><'col-sm-2'l><'col-sm-5'i>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",
            "ordering": false,
            "oLanguage": {
                "sUrl": "../../js/Spanish.lang"
            },
            "processing": true,
            "serverSide": true,
            "ajax": {
                "type": "POST",
                "url": "../cuenta/listaSubcuentas",
                "data": function(d) {
                    d.estado = true;
                    d.codCuenta = parseInt('$cuenta.codCuenta');
                }
            },
            "columnDefs":[
            	{className:"w3-right-align","targets":[4]}
            ],
            "columns": [{
                "data": "codigo"
            }, {
                "data": "nombre"
            }, {
                "data": "descripcion"
            }, {
                "data": "esExterno"
            }, {
                "data": "codSubcuenta"
            }],
            "createdRow": function(row, data, index) {
            	$('td', row).eq(3).html(data.esExterno?'Es externo':'Solo interno');
                $('td', row).eq(4).html('<div class="btn-group"><button class="btn btn-sm btn-success modificar"  data-toggle="tooltip" data-placement="top" title="Editar subcuenta" data-id="' + data.codSubcuenta + '"><i class="fa fa-edit"> | modificar</i> </button><button class="btn btn-sm btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="eliminar subcuenta" data-id="' + data.codSubcuenta + '"><i class="fa fa-remove"> | eliminar</i> </button></div>');
            },
            "drawCallback": function(settings) {
            	$('.modificar').click(function() {
                    $('#formularioModificar').data('formValidation').resetForm();
                    $('#formularioModificar')[0].reset();
                    $.post('../cuenta/obtenerSubcuenta?codSubcuenta=' + $(this).data('id'), function(result) {
                        if (result.status) {
                            $('#formularioModificar').loadJSON(result.data);
                            $('#modalModificar').modal('show');
                        } else {
                            mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                        }
                    }, 'json');
                });
            	$('.eliminar').click(function() {
                    let xcod = $(this).data('id');
                    alertEliminacion('Confirmar eliminacion de subcuenta', 'Esta seguro de eliminar la subcuenta: '+xcod, function(){
                    	$.post('../cuenta/eliminarSubcuenta', {'codSubcuenta':xcod}, function(result) {
                            if (result.status == true) {
                            	mostrarMensaje('info', result.msg);
                            	$('#tabla').dataTable().fnDraw('page');
                            } else {
                                mostrarMensaje('error', result.msg);
                            }
                        }, 'json');
                    });
                });
                $('button[data-toggle="tooltip"]').tooltip({
                    animated: 'fade',
                    placement: 'bottom',
                });
            }
        });
        $('#btnAdicionar').click(function() {
        	$('#formulario')[0].reset();
            $('#formulario').data('formValidation').resetForm();
            $('#codCuenta').val('$cuenta.codCuenta');
            $('#modalAdicionar').modal('show');
        });
        $('#formulario,#formularioModificar').formValidation({
            locale: 'es_ES'
        }).on('success.form.fv', function(e) {
            e.preventDefault();
            var xform = $(e.target);
            $.post(xform.attr('action'), xform.serialize(), function(result) {
                if (result.status == true) {
                    xform.data('formValidation').resetForm();
                    $('.modal').modal('hide');
                    $('#tabla').dataTable().fnDraw('page');
                    mostrarMensaje('info', result.msg);
                } else {
                    mostrarMensaje('error', result.msg);
                }
            }, 'json');
        });
    });
</script>