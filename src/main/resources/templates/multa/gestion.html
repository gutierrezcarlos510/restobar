<section xmlns:th="http://www.thymeleaf.org">
<div class="box box-primary">
    <div class="box-header with-border">
        <form id="formulario" method="post" action="../multa/guardar" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
            <div id="modalAdicionar" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">Adicionar Multa</h4>
                        </div>
                        <div class="modal-body">
                        	<div class="form-group">
                                <label>Fecha</label>
                                <input type="text" class="form-control fec w3-right-align" id="xfecha" name="xfecha" data-fv-notempty="true">
                            </div>
                        	<div class="form-group">
                        		<label>Ayudante </label>
                        		<select id="cod_ayu1" name="codAyu" class="form-control select-chosen" data-placeholder="Seleccionar...">
                        			<option value=""></option>
                                    <option th:each="a : ${ayudantes}" th:value="${a.cod_ayu}" th:text="${a.nom_per} + ' ' + ${a.priape_per} + ' ' + ${a.segape_per}"></option>
                  				</select>
                             </div>
                            
                            <div class="form-group">
                                <label>Monto de multa</label>
                                <input type="text" class="form-control w3-right-align" name="monto" data-fv-notempty="true" min="0.1"  data-fv-numeric="true">
                            </div>
                            <div class="form-group">
                                        <label>Tipo de Multa</label>
                                        <div class="radio">
                                            <label for="plantillaConcepto1"><input type="radio" class="classConcepto" id="plantillaConcepto1" name="plantillaConcepto" value="1" data-fv-notempty="true"/>Por falta a la moral</label><br />
                                            <label for="plantillaConcepto2"><input type="radio" id="plantillaConcepto2" name="plantillaConcepto" value="2" data-fv-notempty="true"/>Por retraso constante con sus estudiantes</label><br />
                                            <label for="plantillaConcepto3"><input type="radio" id="plantillaConcepto3" name="plantillaConcepto" value="3" data-fv-notempty="true"/>Por realizar tratos con los estudiantes directamente.</label><br />
                                            <label for="plantillaConcepto4"><input type="radio" id="plantillaConcepto4" name="plantillaConcepto" value="4" data-fv-notempty="true"/>Por no cumplir las reglas de la instituci&oacute;n</label><br />
                                            <label for="plantillaConcepto5"><input type="radio" id="plantillaConcepto5" name="plantillaConcepto" value="5" data-fv-notempty="true"/>Ninguno. Ingresar uno nuevo</label><br />
                                        </div>
                                    </div>
                            <div class="form-group">
                                <label>Por concepto</label>
                                <textarea class="form-control" id="concepto" name="concepto" rows="5" data-fv-notempty="true"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-social btn-google" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                            <button type="submit" class="btn btn-social btn-bitbucket"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <form id="formularioModificar" method="post" action="../multa/actualizar" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
            <div id="modalModificar" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">Modificar Multa</h4>
                        </div>
                        <div class="modal-body">
                            <input type="hidden"  name="codMulta" />
                            <input type="hidden"  name="tipo" />
                            <div class="form-group">
                                <label>Fecha</label>
                                <input type="text" class="form-control fec  w3-right-align" id="xfecha1" name="xfecha" data-fv-notempty="true">
                            </div>
                        	<div class="form-group">
                        		<label>Ayudante </label>
                        		<select id="codAyu2" name="codAyu" class="form-control select-chosen" data-placeholder="Seleccionar...">
                        			<option value=""></option>
                                    <option th:each="a : ${ayudantes}" th:value="${a.cod_ayu}" th:text="${a.nom_per} + ' ' + ${a.priape_per} + ' ' + ${a.segape_per}"></option>
                  				</select>
                             </div>
                            
                            <div class="form-group">
                                <label>Monto de multa</label>
                                <input type="text" class="form-control  w3-right-align" name="monto" data-fv-notempty="true" min="0.1" data-fv-numeric="true">
                            </div>
                            <div class="form-group">
                                <label>Por concepto</label>
                                <textarea class="form-control"  name="concepto" rows="5" data-fv-notempty="true"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-social btn-google" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                            <button type="submit" class="btn btn-social btn-bitbucket"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        
        <form id="formularioRevisar" method="post" action="../multa/revisar" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
            <div id="modalRevisar" class="modal fade">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                        	<div class="row">
                        		<div class="col-md-7">
                        		<fieldset class="scheduler-border">
								<legend class="scheduler-border"><h4>Datos generales de la multa</h4></legend>
                        		<div class="form-group">
	                                <label>Ayudante</label>
	                                <input type="text" class="form-control w3-right-align" name="xayudante" readonly="readonly">
	                            </div>
                        		<div class="row">
                        			<div class="col-md-6">
                        				<div class="form-group">
			                                <label>Fecha</label>
			                                <input type="text" class="form-control w3-right-align" name="xfecha" readonly="readonly">
			                            </div>
                        			</div>
                        			<div class="col-md-6">
                        				<div class="form-group">
			                                <label>Monto de multa</label>
			                                <input type="text" class="form-control w3-right-align" name="monto" readonly="readonly">
			                            </div>
                        			</div>
                        		</div>
	                            <div class="form-group">
	                                <label>Por concepto</label>
	                                <textarea class="form-control w3-right-align" name="concepto" rows="5" readonly="readonly"></textarea>
	                            </div>
	                            </fieldset>
                        		</div>
                        		<div class="col-md-5">
                        		<fieldset class="scheduler-border">
										<legend class="scheduler-border"><h4>Revision de multa</h4></legend>
										<div class="form-group">
			                                <label>C&oacute;digo de multa</label>
			                                <input type="text" class="form-control w3-right-align" name="codMulta" readonly="readonly">
			                            </div>
		                        		<div class="form-group">
		                                        <label>Cambiar de estado de la multa</label>
		                                        <div class="radio">
		                                            <label for="tipoRealizado"><input type="radio" id="tipoRealizado" name="tipo" value="2" data-fv-notempty="true"/>Realizado</label>
		                                            <label for="tipoPerdonado"><input type="radio" id="tipoPerdonado" name="tipo" value="3" data-fv-notempty="true"/>Perdonado</label>
		                                        </div>
		                                    </div>
		                                    <div class="w3-panel w3-pale-green">
		                                    	<h5><strong>Atenci&oacute;n</strong></h5>
		                                    	<p>Tenga en cuenta que si el estado se cambia a REALIZADO, se asumir&aacute; que ingres&oacute; el efectivo en caja diaria del usuario.</p>
		                                    </div>
		                        		<div class="form-group">
			                                <label>Observaci&oacute;n</label>
			                                <textarea class="form-control" name="observacion" data-fv-notempty="true" ></textarea>
			                            </div>
								</fieldset>
                        		</div>
                        	</div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-social btn-google" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                            <button type="submit" class="btn btn-social btn-bitbucket"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <div class="row">
            <div class="col-md-8">
                <h1><span class="fa  fa-ellipsis-v"></span> Multas </h1>
            </div>
        </div>
    </div>
    <div class="box-body">
        <table id="tabla" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="all">Cod.</th>
                    <th class="all">Ayudante</th>
                    <th class="desktop">Monto</th>
                    <th class="desktop">Concepto</th>
                    <th class="desktop">Estado</th>
                    <th class="all" width="400px">Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <!-- /.box-body -->
</div>
<!-- /.box -->
<script>
    $(document).ready(function() {
    	$('input[type=radio][name=plantillaConcepto]').change(function(){
    		switch (parseInt(this.value)) {
			case 1:
				$('#concepto').val('El ayudante tuvo un compotamiento inapropiado.');
				break;
			case 2:
				$('#concepto').val('Porque el ayudante tiene varios retrasos con los estudiantes.');
				break;
			case 3:
				$('#concepto').val('El ayudante realizo tratos de forma directa con los clientes por lo cual es una falta grave.');
				break;
			case 4:
				$('#concepto').val('El ayudante realizo incumplimiento a las normas establecidas por la institucion, la cual es la siguiente: ...');
				break;
			case 5:
				$('#concepto').val('');
				break;

			default:
				$('#concepto').val('-');
				break;
			}
    	})
    	$(".fec").inputmask("dd/mm/yyyy", {
            "placeholder": "dd/mm/yyyy"
        });
        $('.select-chosen').chosen({
            no_results_text: "No se encuentra:",
            width: '100%'
        });
        var tablaMulta = $('#tabla').DataTable({
            buttons: [{
                text: 'Adicionar',
                className: "btn-primary btn-block active",
                action: function(e, dt, node, config) {
                    $('#formulario')[0].reset();
                    $('#formulario').data('formValidation').resetForm();
                    $('#cod_ayu1').val('').trigger('chosen:updated');
                    $('#xfecha').val(UtilDate.formatDate(new Date(),'DD/MM/YYYY'));
                    $('#modalAdicionar').modal('show');
                }
            }],
            "ajax": {
                "type": "POST",
                "url": "../multa/lista",
                "data": function(d) {
                    d.estado = true;
                }
            },
            "columnDefs":[{targets:[5],className:"text-right"}],
            "columns": [{
                "data": "codMulta"
            }, {
                "data": "xayudante"
            }, {
                "data": "monto"
            }, {
                "data": "concepto"
            }, {
                "data": "xtipo"
            }, {
                "data": "codMulta"
            }],
            "createdRow": function(row, data, index) {
            	let btnAction = '';
            	if(data.tipo == 1){
            		btnAction = '<button class="btn btn-success revisar" title="Revisar"><i class="glyphicon glyphicon-plus-sign"></i><br>revisar</button>';
            		btnAction += '<button class="btn btn-primary modificar" title="Modificar"><i class="fa fa-edit"></i><br>editar</button>';
            		btnAction += '<button class="btn btn-danger eliminar" title="Eliminar"><i class="glyphicon glyphicon-remove"></i><br>eliminar</button>';
            	}
            	btnAction += '<button class="btn btn-info imprimir" title="Imprimir"><i class="glyphicon glyphicon-print"></i><br>imprimir</button>';
            	$('td', row).eq(5).html('<div class="btn-group-xs">'+btnAction+'</div>');
            },
            "drawCallback": function(settings) {
                $('.eliminar').click(function() {
                	let obj = tablaMulta.row($(this).closest('tr')).data();
                	alertEliminacion("Eliminacion de multa", ("Cod. Multa: "+ obj.codMulta+", Ayudante: "+obj.xayudante+", Monto: "+obj.monto), function(){
        				jQuery.post('../multa/eliminar?codMulta='+obj.codMulta, function(resp){
        					if(resp.status){
        						$('#tabla').dataTable().fnDraw('page');
        						mostrarMensaje('success', resp.msg);
        					}else{
        						modalAlert('Error de eliminacion', resp.msg,'error');
        					}
        				});
        			});
                });
                $('.modificar').click(function() {
                	let obj = tablaMulta.row($(this).closest('tr')).data();
                    $('#formularioModificar').data('formValidation').resetForm();
                    $('#formularioModificar')[0].reset();
                    $('#formularioModificar').loadJSON(obj);
                    $('#codAyu2').val(obj.codAyu).trigger('chosen:updated');
                    $('#modalModificar').modal('show');
                });
                $('.revisar').click(function() {
                	let obj = tablaMulta.row($(this).closest('tr')).data();
                    $('#formularioRevisar').data('formValidation').resetForm();
                    $('#formularioRevisar')[0].reset();
                    obj.observacion = 'Revision manual, sin observaciones';
                    $('#formularioRevisar').loadJSON(obj);
                    $('#modalRevisar').modal('show');
                });
                $('.imprimir').click(function() {
                	let obj = tablaMulta.row($(this).closest('tr')).data();
                    $("#frameReportes").attr("src", "../multa/ver?codMulta=" + obj.codMulta);
                    $("#reportes").modal('show');
                });
            }
        });
        $('#formulario,#formularioModificar,#formularioRevisar').formValidation({
            locale: 'es_ES'
        }).on('success.form.fv', function(e) {
            e.preventDefault();
            alertAdicion('Confirmar transaccion', 'Esta seguro de realizar la transaccion?',function(){
            var xform = $(e.target);
            $.post(xform.attr('action'), xform.serialize(), function(result) {
                if (result.status == true) {
                    xform.data('formValidation').resetForm();
                    $('.modal').modal('hide');
                    $('#tabla').dataTable().fnDraw('page');
                    mostrarMensaje('info', 'Se realizo con exito la Transaccion');
                } else {
                    mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                }
            }, 'json');
            });
        });
    });
</script>
</section>