<section xmlns:th="http://www.thymeleaf.org">
<div class="box box-primary">
    <div class="box-header with-border">
        <div id="modalRevisar" class="modal fade" data-backdrop="static">
            <div class="modal-dialog" style="min-width: 90%;">
                <form id="formularioRevisar" method="post" action="../prestacion/revisar" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="cod_pre" />
                            <div class="row">
                                <div class="col-md-4">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Prestaci&oacute;n</legend>
                                    <dl class="dl-horizontal h4" id="dataRevisar">
                                        <dt>Cod. Prestaci&oacute;n</dt>
                                        <dd aria-label="cod_pre"></dd>
                                        <dt>Estado</dt>
                                        <dd aria-label="xtipo"></dd>
                                        <dt>Fecha de registro</dt>
                                        <dd aria-label="fecha"></dd>
                                        <dt>Estudiante</dt>
                                        <dd aria-label="estudiante"></dd>
                                        <dt>Docente</dt>
                                        <dd aria-label="docente"></dd>
                                        <dt>Ayudante</dt>
                                        <dd aria-label="ayudante"></dd>
                                        <dt>Usuario</dt>
                                        <dd aria-label="usuario"></dd>
                                        <dt>Fecha de Entrega</dt>
                                        <dd><span aria-label="entrega"></span> <span aria-label="horent_pre"></span></dd>
                                        <dt>Descripci&oacute;n</dt>
                                        <dd aria-label="obs_pre"></dd>
                                        <dt>Total</dt>
                                        <dd aria-label="tot_pre"></dd>
                                        <dt>Descuento</dt>
                                        <dd aria-label="des_pre"></dd>
                                        <dt>Total a pagar</dt>
                                        <dd aria-label="total"></dd>
                                        <dt>Saldo a favor</dt>
                                        <dd aria-label="sal_pre"></dd>
                                        <dt>Saldo restante</dt>
                                        <dd aria-label="totalDeuda"></dd>
                                    </dl>
                                    </fieldset>
                                </div>
                                <div class="col-md-5">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Detalle de prestaci&oacute;n</legend>
                                	<table class="w3-table-all" id="tablaDetallesRevisar">
                                		<thead>
                                			<tr>
                                				<td colspan="3" class="w3-center">Detalle de servicios</td>
                                			</tr>
                                			<tr  style="border-bottom: 1px solid black;">
                                				<td>Servicio</td>
                                				<td>Tema</td>
                                				<td>Precio</td>
                                			</tr>
                                		</thead>
                                		<tbody></tbody>
                                		<tfoot style="font-weight: bolder;"></tfoot>
                                	</table>
                                	</fieldset>
                                </div>
                                <div class="col-md-3">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Revisar Prestaci&oacute;n</legend>
                                    <div class="form-group">
                                        <label>Tipo de revisi&oacute;n</label>
                                        <div class="radio">
                                            <label for="cumplido"><input type="radio" id="cumplido" name="tip_pre" value="2" data-fv-notempty="true"/>Cumplido</label><br />
                                            <label for="incumplido"><input type="radio"  id="incumplido" name="tip_pre" value="3" data-fv-notempty="true"/>Incumplido</label><br />
                                            <label for="abandonado"><input type="radio"  id="abandonado" name="tip_pre" value="5" data-fv-notempty="true"/>Abandonado</label><br />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Observaci&oacute;n</label>
                                        <textarea class="form-control" placeholder="Ingresar alguna descripcion u observacion" rows="4" id="obs_pre" name="obs_pre" data-fv-notempty="true">Sin observaciones.</textarea>
                                    </div>
                                   </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger pull-left" data-dismiss="modal"><i class="fa fa-close"></i> Cancelar</button>
                            <button type="submit" class="btn btn-primary"><i class="fa fa-check-circle"></i> Aceptar</button>
                        </div>
                    </div>
                </form>
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <div id="modalPagar" class="modal fade" data-backdrop="static">
            <div class="modal-dialog" style="min-width: 98%;">
                <form id="formularioPagar" method="post" action="../prestacion/pagar" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="cod_pre" />
                            <div class="row">
                                <div class="col-md-5">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Prestaci&oacute;n</legend>
                                    <dl class="dl-horizontal h4" id="dataPago">
                                        <dt>Cod. Prestaci&oacute;n</dt>
                                        <dd aria-label="cod_pre"></dd>
                                        <dt>Estado</dt>
                                        <dd aria-label="xtipo"></dd>
                                        <dt>Fecha de registro</dt>
                                        <dd aria-label="fecha"></dd>
                                        <dt>Estudiante</dt>
                                        <dd aria-label="estudiante"></dd>
                                        <dt>Docente</dt>
                                        <dd aria-label="docente"></dd>
                                        <dt>Ayudante</dt>
                                        <dd aria-label="ayudante"></dd>
                                        <dt>Usuario</dt>
                                        <dd aria-label="usuario"></dd>
                                        <dt>Fecha de Entrega</dt>
                                        <dd><span aria-label="entrega"></span> <span aria-label="horent_pre"></span></dd>
                                        <dt>Descripci&oacute;n</dt>
                                        <dd aria-label="obs_pre"></dd>
                                        <dt>Total</dt>
                                        <dd aria-label="tot_pre"></dd>
                                        <dt>Descuento</dt>
                                        <dd aria-label="des_pre"></dd>
                                        <dt>Total a pagar</dt>
                                        <dd aria-label="total"></dd>
                                        <dt>Saldo a favor</dt>
                                        <dd aria-label="sal_pre"></dd>
                                        <dt>Saldo restante</dt>
                                        <dd aria-label="totalDeuda"></dd>
                                    </dl>
                                    </fieldset>
                                </div>
                                <div class="col-md-4">
                                <fieldset class="scheduler-border" >
										<legend class="scheduler-border">Detalle de prestaci&oacute;n</legend>
                                <table class="w3-table-all" id="tablaDetallesPago">
                                		<thead>
                                			<tr>
                                				<td colspan="3" class="w3-center">Detalle de servicios</td>
                                			</tr>
                                			<tr  style="border-bottom: 1px solid black;">
                                				<td>Servicio</td>
                                				<td>Tema</td>
                                				<td>Precio</td>
                                			</tr>
                                		</thead>
                                		<tbody></tbody>
                                		<tfoot style="font-weight: bolder;"></tfoot>
                                	</table>
                                	</fieldset>
                                </div>
                                <div class="col-md-3">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Detalle de pago</legend>
                                    <div class="form-group">
                                    	<label>Total a pagar</label>
                                    	<span aria-label="total" class="form-control w3-right-align w3-border-0"></span>
                                    </div>
                                    <div class="form-group">
                                    	<label>A cuenta</label>
                                    	<span aria-label="sal_pre" class="form-control w3-right-align w3-border-0"></span>
                                    </div>
                                    <div class="form-group">
                                    	<label>Saldo restante</label>
                                    	<span aria-label="totalDeuda" class="form-control w3-right-align w3-border-0"></span>
                                    </div>
                                    <div class="form-group">
                                    	<label>Forma de pago</label>
                                    	<div class="radio">
                                    		<label for="ventaEfectivo"><input type="radio" id="ventaEfectivo" class="campoFormaPago" name="formapago" value="0" data-fv-notempty="true" checked="checked"/>En efectivo</label>
                                    		<label for="ventaBanco"><input type="radio"  id="ventaBanco" class="campoFormaPago" name="formapago" value="1" data-fv-notempty="true"/>Deposito bancario</label>
                                    	</div>
                                    </div>
                                    <div class="form-group" style="display: none" id="areaSubcuenta">
                                    	<label for="codSubcuenta">Deposito bancario</label>
                                    	<select name="codSubcuenta" id="codSubcuenta" class="form-control select-chosen">
                                    		<option value="">Seleccionar</option>
                                            <option th:each="c : ${cuentas}" th:value="${c.codSubcuenta}" th:text="${c.nombre}"></option>
						                 </select>
						            </div>
                                    <div class="form-group">
                                        <label>Monto a pagar</label>
                                        <div class="form-group">
                                            <input type="text" id="sal_pre" name="sal_pre" min="0.1" class="form-control w3-right-align" data-fv-notempty="true" data-fv-numeric="true">
                                        </div>
                                    </div>
                                    <div class="from-group">
                                    	<div class="form-check">
			                    		<input type="checkbox" class="form-check-input" id="pagototal" /> <label class="form-check-label" for="pagototal"> Pagar todo</label>
			                    		</div>
                                    </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger pull-left" data-dismiss="modal"><i class="fa fa-close"></i> Cancelar</button>
                            <button type="submit" class="btn btn-primary"><i class="fa fa-check-circle"></i> Aceptar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <div id="modalDevolver" class="modal fade" data-backdrop="static">
            <div class="modal-dialog" style="min-width: 98%;">
                <form id="formularioDevolver" method="post" action="../prestacion/devolver" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="cod_pre" />
                            <div class="row">
                                <div class="col-md-5">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Prestaci&oacute;n</legend>
                                    <dl class="dl-horizontal h4" id="dataDevolucion">
                                        <dt>Cod. Prestaci&oacute;n</dt>
                                        <dd aria-label="cod_pre"></dd>
                                        <dt>Estado</dt>
                                        <dd aria-label="xtipo"></dd>
                                        <dt>Fecha de registro</dt>
                                        <dd aria-label="fecha"></dd>
                                        <dt>Estudiante</dt>
                                        <dd aria-label="estudiante"></dd>
                                        <dt>Docente</dt>
                                        <dd aria-label="docente"></dd>
                                        <dt>Ayudante</dt>
                                        <dd aria-label="ayudante"></dd>
                                        <dt>Usuario</dt>
                                        <dd aria-label="usuario"></dd>
                                        <dt>Fecha de Entrega</dt>
                                        <dd><span aria-label="entrega"></span> <span aria-label="horent_pre"></span></dd>
                                        <dt>Descripci&oacute;n</dt>
                                        <dd aria-label="obs_pre"></dd>
                                        <dt>Total</dt>
                                        <dd aria-label="tot_pre"></dd>
                                        <dt>Descuento</dt>
                                        <dd aria-label="des_pre"></dd>
                                        <dt>Total a pagar</dt>
                                        <dd aria-label="total"></dd>
                                        <dt>Saldo a favor</dt>
                                        <dd aria-label="sal_pre"></dd>
                                        <dt>Saldo restante</dt>
                                        <dd aria-label="totalDeuda"></dd>
                                    </dl>
                                    </fieldset>
                                </div>
                                <div class="col-md-4">
                                <fieldset class="scheduler-border" >
										<legend class="scheduler-border">Detalle de prestaci&oacute;n</legend>
                                <table class="w3-table-all" id="tablaDetallesDevolucion">
                                		<thead>
                                			<tr>
                                				<td colspan="3" class="w3-center">Detalle de servicios</td>
                                			</tr>
                                			<tr  style="border-bottom: 1px solid black;">
                                				<td>Servicio</td>
                                				<td>Tema</td>
                                				<td>Precio</td>
                                			</tr>
                                		</thead>
                                		<tbody></tbody>
                                		<tfoot style="font-weight: bolder;"></tfoot>
                                	</table>
                                	</fieldset>
                                </div>
                                <div class="col-md-3">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Devoluci&oacute;n</legend>
                                    <div class="form-group">
                                    	<label>Total a pagar</label>
                                    	<span aria-label="total" class="form-control w3-right-align w3-border-0"></span>
                                    </div>
                                    <div class="form-group">
                                    	<label>A cuenta</label>
                                    	<span aria-label="sal_pre" class="form-control w3-right-align w3-border-0"></span>
                                    </div>
                                    <div class="form-group">
                                    	<label>Forma de pago</label>
                                    	<div class="radio">
                                    		<label for="ventaEfectivo2"><input type="radio" id="ventaEfectivo2" class="campoFormaPago2" name="formapago2" value="0" data-fv-notempty="true" checked="checked"/>En efectivo</label>
                                    		<label for="ventaBanco2"><input type="radio"  id="ventaBanco2" class="campoFormaPago2" name="formapago2" value="1" data-fv-notempty="true"/>Deposito bancario</label>
                                    	</div>
                                    </div>
                                    <div class="form-group" style="display: none" id="areaSubcuenta2">
                                    	<label for="codSubcuenta2">Deposito bancario</label>
                                    	<select name="codSubcuenta" id="codSubcuenta2" class="form-control select-chosen">
                                    		<option value="">Seleccionar</option>
                                            <option th:each="c : ${cuentas}" th:value="${c.codSubcuenta}" th:text="${c.nombre}"></option>
						                 </select>
						            </div>
                                    <div class="form-group">
                                        <label>Monto a devolver</label>
                                        <div class="form-group">
                                            <input type="text" id="montoDevolucion" name="montoDevolucion" min="0" class="form-control w3-right-align" data-fv-notempty="true" data-fv-numeric="true">
                                        </div>
                                    </div>
                                    <div class="from-group text-right">
                                    	<div class="form-check">
			                    		<input type="checkbox" class="form-check-input" id="devolucionTotal" /> <label class="form-check-label" for="devolucionTotal"> Devolver todo</label>
			                    		</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Concepto por devoluci&oacute;n</label>
                                        <div class="form-group">
                                            <textarea id="observacionDevolucion" name="observacionDevolucion" class="form-control" rows="4" data-fv-notempty="true"></textarea>
                                        </div>
                                    </div>
                                    <div class="from-group text-right">
                                    	<div class="form-check">
			                    		<input type="checkbox" class="form-check-input" id="checkDevolucion" /> <label class="form-check-label" for="checkDevolucion"> Agregar concepto por defecto</label>
			                    		</div>
                                    </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger pull-left" data-dismiss="modal"><i class="fa fa-close"></i> Cancelar</button>
                            <button type="submit" class="btn btn-primary"><i class="fa fa-check-circle"></i> Aceptar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="modalCambiar" class="modal modal-default fade" data-backdrop="static">
            <div class="modal-dialog" style="min-width: 98%">
                <form id="formularioCambiar" method="post" action="../prestacion/cambiar" data-fv-framework="bootstrap" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="cod_pre" />
                            <div class="row">
                                <div class="col-md-5">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Prestaci&oacute;n</legend>
                                    <dl class="dl-horizontal h4" id="dataCambio">
                                        <dt>Cod. Prestaci&oacute;n</dt>
                                        <dd aria-label="cod_pre"></dd>
                                        <dt>Estado</dt>
                                        <dd aria-label="xtipo"></dd>
                                        <dt>Fecha de registro</dt>
                                        <dd aria-label="fecha"></dd>
                                        <dt>Estudiante</dt>
                                        <dd aria-label="estudiante"></dd>
                                        <dt>Docente</dt>
                                        <dd aria-label="docente"></dd>
                                        <dt>Ayudante</dt>
                                        <dd aria-label="ayudante"></dd>
                                        <dt>Usuario</dt>
                                        <dd aria-label="usuario"></dd>
                                        <dt>Fecha de Entrega</dt>
                                        <dd><span aria-label="entrega"></span> <span aria-label="horent_pre"></span></dd>
                                        <dt>Descripci&oacute;n</dt>
                                        <dd aria-label="obs_pre"></dd>
                                        <dt>Total</dt>
                                        <dd aria-label="tot_pre"></dd>
                                        <dt>Descuento</dt>
                                        <dd aria-label="des_pre"></dd>
                                        <dt>Total a pagar</dt>
                                        <dd aria-label="total"></dd>
                                        <dt>Saldo a favor</dt>
                                        <dd aria-label="sal_pre"></dd>
                                        <dt>Saldo restante</dt>
                                        <dd aria-label="totalDeuda"></dd>
                                    </dl>
                                    </fieldset>
                                </div>
                                <div class="col-md-4">
                                <fieldset class="scheduler-border">
										<legend class="scheduler-border">Detalle de prestaci&oacute;n</legend>
                                <table class="w3-table-all" id="tablaDetallesCambio">
                                		<thead style="font-weight: bolder;" >
                                			<tr>
                                				<td colspan="3" class="w3-center">Detalle de servicios</td>
                                			</tr>
                                			<tr style="border-bottom: 1px solid black;">
                                				<td>Servicio</td>
                                				<td>Tema</td>
                                				<td>Precio</td>
                                			</tr>
                                		</thead>
                                		<tbody></tbody>
                                		<tfoot style="font-weight: bolder;"></tfoot>
                                	</table>
                                	</fieldset>
                                </div>
                                <div class="col-md-3">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Modificar</legend>
		                            <input type="hidden" name="cod_est" />
		                            <div class="form-group">
		                                <label>Ayudante</label>
		                                <div class="form-group">
		                                    <select id="ayudante" name="cod_ayu" class="form-control select-chosen" data-fv-notempty="true">
		                      			<option value="">Seleccionar...</option>
                                        <option th:each="a : ${ayudantes}" th:value="${a.cod_ayu}" th:text="${a.nom_per} +' '+ ${a.priape_per} +' '+ ${a.segape_per}"></option>
		                      		</select>
		                                </div>
		                            </div>
		                            <div class="form-group">
				                        <label class="control-label">Fecha de Entrega</label>
                                        <input type="hidden" id="entrega" name="entrega">
				                        <input type="date" id="fecent_pre" name="fecent_pre" value="" class="form-control" data-fv-notempty="true" />
				                    </div>
				                    <div class="form-group">
				                        <label class="control-label">Hora de Entrega</label>
				                        <input type="time" id="horenc_pre" name="horent_pre" class="form-control" data-fv-notempty="true" />
				                    </div>
				                    <div class="form-group">
				                        <label class="control-label">Observaci&oacute;n</label>
				                        <textarea class="form-control" placeholder="Ingresar alguna descripcion u observacion" rows="3" id="obs_pre3" name="obs_pre" data-fv-notempty="true">Sin observaciones.</textarea>
				                    </div>
		                            </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn pull-left btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Cancelar</button>
                            <button type="submit" class="btn btn-success"><i class="fa fa-check-circle"></i> Aceptar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <div id="modalVer" class="modal modal-default fade" data-backdrop="static">
            <div class="modal-dialog" style="min-width: 95%">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="cod_pre" />
                            <div class="row">
                                <div class="col-md-5">
                                	<fieldset class="scheduler-border">
										<legend class="scheduler-border">Prestaci&oacute;n</legend>
                                    <dl class="dl-horizontal h4" id="dataVer">
                                        <dt>Cod. Prestaci&oacute;n</dt>
                                        <dd aria-label="cod_pre"></dd>
                                        <dt>Estado</dt>
                                        <dd aria-label="xtipo"></dd>
                                        <dt>Fecha de registro</dt>
                                        <dd aria-label="fecha"></dd>
                                        <dt>Estudiante</dt>
                                        <dd aria-label="estudiante"></dd>
                                        <dt>Docente</dt>
                                        <dd aria-label="docente"></dd>
                                        <dt>Ayudante</dt>
                                        <dd aria-label="ayudante"></dd>
                                        <dt>Usuario</dt>
                                        <dd aria-label="usuario"></dd>
                                        <dt>Fecha de Entrega</dt>
                                        <dd><span aria-label="entrega"></span> <span aria-label="horent_pre"></span></dd>
                                        <dt>Descripci&oacute;n</dt>
                                        <dd aria-label="obs_pre"></dd>
                                        <dt>Total</dt>
                                        <dd aria-label="tot_pre"></dd>
                                        <dt>Descuento</dt>
                                        <dd aria-label="des_pre"></dd>
                                        <dt>Total a pagar</dt>
                                        <dd aria-label="total"></dd>
                                        <dt>Saldo a favor</dt>
                                        <dd aria-label="sal_pre"></dd>
                                        <dt>Saldo restante</dt>
                                        <dd aria-label="totalDeuda"></dd>
                                    </dl>
                                    </fieldset>
                                </div>
                                <div class="col-md-4">
                                <fieldset class="scheduler-border">
										<legend class="scheduler-border">Detalle de prestaci&oacute;n</legend>
                                <table class="w3-table-all" id="tablaDetallesVer">
                                		<thead style="font-weight: bolder;" >
                                			<tr>
                                				<td colspan="3" class="w3-center">Detalle de servicios</td>
                                			</tr>
                                			<tr style="border-bottom: 1px solid black;">
                                				<td>Servicio</td>
                                				<td>Tema</td>
                                				<td>Precio</td>
                                			</tr>
                                		</thead>
                                		<tbody></tbody>
                                		<tfoot style="font-weight: bolder;"></tfoot>
                                	</table>
                                	</fieldset>
                                </div>
                                <div class="col-md-3">
                                	<button type="button" class="btn btn-social btn-block bg-olive" onclick="enviarMensajeAyudante()"><i class="fa fa-whatsapp"></i> Enviar mensaje al ayudante</button><br />
                                	<button type="button" class="btn btn-social btn-block bg-olive" onclick="enviarMensajeEstudiante()"><i class="fa fa-whatsapp"></i> Enviar mensaje al estudiante</button><br />
                                	<button type="button" class="btn btn-social btn-block btn-primary" onclick="imprimir()"><i class="fa fa-print"></i> Imprimir recibo</button><br />
                                	<button type="button" class="btn btn-social btn-block btn-info" onclick="descargarImagen()"><i class="fa fa-file-image-o"></i> Descargar imagen</button><br />
                                	<button type="button" class="btn btn-social btn-block btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Cerrar Vista</button>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <h1><span class="fa  fa-ellipsis-v"></span> Prestaciones</h1>
            </div>
            <div class="col-md-2">
                <button class="btn btn-foursquare btn-block" id="btnCotizaciones">
                    <i class="fa fa-usd"></i><br>
                    Cotizaciones
                </button>
            </div>
            <div class="col-md-4"><b>Mostrar Prestaciones creadas por: </b>
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-primary active usuarioRadio">
							<i class="fa fa-user"></i> <input type="radio" name="usuario" value="true" title="Prestacions Propias"> Mi usuario
						</label>
                    <label class="btn btn-success usuarioRadio" title="Prestaciones generales">
							<i class="fa fa-users"></i> <input type="radio" name="usuario" value="false" checked="checked"> Todos
						</label>
                </div>
            </div>
            <div class="col-md-3"><b>Estado:</b>
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-primary active estadoRadio"> 
							<input type="radio" name="estado" value="true" title="Mostrar Activos" checked> Activo
						</label>
                    <label class="btn btn-danger estadoRadio" title="Mostrar Inactivos">
							<input type="radio" name="estado" value="false"> Inactivo
						</label>
                </div>
            </div>
        </div>
    	<div class="row">
            <div class="col-md-6">
                <fieldset class="scheduler-border">
                    <legend class="scheduler-border"><h5>Prestaciones en proceso</h5></legend>
                    <div class="btn-group-xs btn-group-justified">
                        <label class="btn btn-info active tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="-1" title="Mostrar Pendientes"> <br />Todos
                            <br><strong class="h4"><i class="fa fa-users"></i></strong>
                        </label>
                        <label class="btn btn-primary active tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="1" title="Mostrar Pendientes" checked="checked"> <br />Pendientes
                            <br><strong class="h4"><span class="fa fa-hourglass-half"></span></strong>
                        </label>
                        <label class="btn btn-success tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="2" title="Mostrar Cumplidos"> <br />Cumplidos
                            <br><strong class="h4"><i class="fa fa-check-square-o"></i></strong>
                        </label>
                        <label class="btn btn-danger tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="3" title="Mostrar Incumplidos"> <br />Incumplidos
                            <br><strong class="h4"><i class="fa fa-times"></i></strong>
                        </label>
                        <label class="btn btn-warning active tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="5" title="Mostrar abandonados"> <br />Abandonados
                            <br><strong class="h4"><i class="fa fa-user-times"></i></strong>
                        </label>
                    </div>
                </fieldset>
            </div>
            <div class="col-md-6">
                <fieldset class="scheduler-border">
                    <legend class="scheduler-border"><h5>Prestaciones con pagos o multas</h5></legend>
                    <div class="btn-group-xs btn-group-justified">
                        <label class="btn btn-success tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="4" title="Mostrar Cumplidos Pagados"> <br />Cumplidos
                            <br><strong class="h4"><i class="fa fa-check-square-o"></i> <i class="fa fa-usd"></i></strong>
                        </label>
                        <label class="btn btn-sm btn-warning active tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="6" title="Mostrar Abandonados pagados"> <br />Abandonados
                            <br><strong class="h4"><i class="fa fa-user-times"></i> <i class="fa fa-usd"></i></strong>
                        </label>
                        <label class="btn btn-sm btn-danger tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="7" title="Mostrar Incumplidos multados"> <br />Multados
                            <br><strong class="h4"><i class="fa fa-times"></i> <i class="fa fa-usd"></i></strong>
                        </label>
                        <label class="btn btn-sm btn-primary tipoRadio" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <input type="radio" name="tipo" value="8" title="Mostrar Incumplidos perdonados"> <br />Perdonados
                            <br><strong class="h4"><i class="fa fa-times"></i> <i class="fa fa-usd"></i></strong>
                        </label>
                    </div>
                </fieldset>
            </div>
            </div>
        <div class="row" style="display: none;">
        	<div class="col-md-4 text-right">
        		<h5><strong>Filtras las prestaciones por fecha: </strong></h5>
        	</div>
            <div class="col-md-4">
                <label class="col-xs-5 control-label">Fecha Inicio</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control input-sm fecha" id="fini" name="fini">
                </div>
            </div>
            <div class="col-md-4">
                <label class="col-xs-5 control-label">Fecha Fin</label>
                <div class="col-xs-7">
                    <input type="text" class="form-control input-sm fecha" id="ffin" name="ffin">
                </div>
            </div>
        </div>
    </div>

    <div class="box-body">
        <table id="tabla" class="table table-striped table-bordered dt-responsive" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="all">Cod.</th>
                    <th class="desktop">Fecha Entrega</th>
                    <th class="none">Hora de entrega</th>
                    <th class="all">Estudiante</th>
                    <th class="none">Estudiante</th>
                    <th class="desktop">Ayudante</th>
                    <th class="desktop">Estado</th>
                    <th class="none">Docente</th>
                    <th class="none">Fecha de registro</th>
                    <th class="none">Observaci&oacute;n</th>
                    <th class="none">Telf. Ayudante</th>
                    <th class="none">Telf. Estudiante</th>
                    <th class="none">Total Prestaci&oacute;n</th>
                    <th class="none">Saldo o deuda</th>
                    <th class="all">Acciones</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
    <!-- /.box-body -->
</div>
<div id="prestacion-img" style="display: none;">
<div style="width: 500px;">
	<fieldset class="scheduler-border">
		<legend class="scheduler-border">Prestaci&oacute;n</legend>
		<div class="text-right">
		
		</div>
			<dl class="dl-horizontal" id="dataImage">
				<dt>Cod. Prestaci&oacute;n</dt>
				<dd aria-label="cod_pre"></dd>
				<dt>Fecha de registro</dt>
				<dd aria-label="fecha"></dd>
				<dt>Estudiante</dt>
				<dd aria-label="estudiante"></dd>
				<dt>Registrado por</dt>
				<dd aria-label="usuario"></dd>
				<dt>Fecha de Entrega</dt>
				<dd>
					<span aria-label="entrega"></span> <span aria-label="horent_pre"></span>
				</dd>
				<dt>Descripci&oacute;n</dt>
				<dd aria-label="obs_pre"></dd>
				<dt>Total a pagar</dt>
				<dd aria-label="total"></dd>
				<dt>Saldo a favor</dt>
				<dd aria-label="sal_pre"></dd>
				<dt>Saldo restante</dt>
				<dd aria-label="totalDeuda"></dd>
			</dl>
			<table class="w3-table-all" id="tablaDetallesImagen">
			<thead style="font-weight: bolder;">
				<tr>
					<td colspan="3" class="w3-center">Detalle de servicios</td>
				</tr>
				<tr style="border-bottom: 1px solid black;">
					<td>Servicio</td>
					<td>Tema</td>
					<td>Precio</td>
				</tr>
			</thead>
			<tbody></tbody>
			<tfoot style="font-weight: bolder;"></tfoot>
		</table>
		<img class="img img-thumbnail" src="../../img/banner.jpg"/>
	</fieldset>
</div>
</div>

<script>
var dataPrestacion = {};
function descargarImagen(){
	let obj = dataPrestacion;
	obj.estudiante = obj.estudiante + ' (cel.'+(obj.telEstudiante||'')+')';
	$('#dataImage').loadJSON(obj);
	$('#prestacion-img').show();
	$.post('../prestacion/obtenerDetalles?cod_pre=' + obj.cod_pre, function(resp){
    	$('#tablaDetallesImagen > tbody').html('');
    	$('#tablaDetallesImagen > tfoot').html('');
    	if(resp.status){
    		let total = 0;
    		if(resp.data){
    			resp.data.forEach(item =>{
    				let tr= $('<tr></tr>');
    				$('<td>'+item.servicio+'</td>').appendTo(tr);
    				$('<td>'+item.nomTem+'</td>').appendTo(tr);
    				$('<td class="w3-right-align">'+item.pre_detpre+'</td>').appendTo(tr);
    				$('#tablaDetallesImagen > tbody:last').append(tr);
    				total += item.pre_detpre;
    			});

				let tr= $('<tr style="border-top: 3px solid black;"></tr>');
				$('<td colspan="2" class="w3-right-align">SUBTOTAL'+'</td>').appendTo(tr);
				$('<td class="w3-right-align">'+total+'</td>').appendTo(tr);
				$('#tablaDetallesImagen > tfoot:last').append(tr);
				tr= $('<tr></tr>');
				$('<td colspan="2" class="w3-right-align">DESCUENTO: '+'</td>').appendTo(tr);
				$('<td class="w3-right-align">'+obj.des_pre+'</td>').appendTo(tr);
				$('#tablaDetallesImagen > tfoot:last').append(tr);
				tr= $('<tr></tr>');
				$('<td colspan="2" class="w3-right-align">TOTAL A PAGAR: '+numeroALetras(obj.total)+'</td>').appendTo(tr);
				$('<td class="w3-right-align">'+obj.total+'</td>').appendTo(tr);
				$('#tablaDetallesImagen > tfoot:last').append(tr);
    		}else{
    			let tr= $('<tr><td colspan="3" class="w3-center">Sin datos</td></tr>');
    		}
    		let node = document.getElementById('prestacion-img');

            domtoimage.toPng(node).then(function (dataUrl) {
                let link = document.createElement('a');
                link.download = 'prestacion-'+obj.cod_pre+'.png';
                link.href = dataUrl;
                link.click();
                $('#prestacion-img').hide();
            }).catch(function (error) {
                console.error('oops, Error al descargar imagen de prestacion!', error);
            });
    	}
    });
}
function imprimir(){
    $("#frameReportes").attr("src", "../prestacion/ver?cod_pre="+dataPrestacion.cod_pre);
    $("#reportes").modal('show');
}
function enviarMensajeAyudante(){
	let dataSend = '-- PRESTACION --\n';
	dataSend += 'Prestacion No.: '+dataPrestacion.cod_pre+'\n';
	dataSend += 'Fecha de entrega: '+dataPrestacion.entrega+'\n';
	dataSend += 'Cliente: '+dataPrestacion.estudiante+'\n';
	dataSend += 'Total:\t'+dataPrestacion.total+'\n';
	dataSend += 'Saldo a favor:\t'+dataPrestacion.sal_pre+'\n';
	dataSend += 'Saldo a deber:\t'+dataPrestacion.totalDeuda+'\n\n\n';
	dataSend += 'Cualquier duda estamos para ayudarle, Resultado Final.';
	let dataEncode = encodeURI(dataSend);
	window.open('https://wa.me/591'+dataPrestacion.telAyudante+'?text='+dataEncode, '_blank');
}

function enviarMensajeEstudiante(){
	let dataSend = '-- PRESTACION --\n';
	dataSend += 'Prestacion No.: '+dataPrestacion.cod_pre+'\n';
	dataSend += 'Fecha de entrega: '+dataPrestacion.entrega+'\n';
	dataSend += 'Cliente: '+dataPrestacion.estudiante+'\n';
	dataSend += 'Total:\t'+dataPrestacion.total+'\n';
	dataSend += 'Saldo a favor:\t'+dataPrestacion.sal_pre+'\n';
	dataSend += 'Saldo a deber:\t'+dataPrestacion.totalDeuda+'\n\n\n';
	dataSend += 'Gracias por su confianza, estamos en contacto, les deseamos que tenga un buen dia. Resultado Final.';

	let dataEncode = encodeURI(dataSend);
	
	window.open('https://wa.me/591'+dataPrestacion.telEstudiante+'?text='+dataEncode, '_blank');
}
    $(document).ready(function() {
    	$('#btnCotizaciones').click(function(){
    	abrirLoad();
        $.post('../cotizacion/gestion', function(resp) {
            $('#contenedor').html(resp);
            cerrarLoad();
        });
    	});
    	$('.campoFormaPago').change(function(){
        	let value = parseInt(this.value);
        	if(value===1){
        		$('#areaSubcuenta').show(500);
        	}else{
        		$('#areaSubcuenta').hide(500);
        	}
        });
    	$('.campoFormaPago2').change(function(){
        	let value = parseInt(this.value);
        	if(value===1){
        		$('#areaSubcuenta2').show(500);
        	}else{
        		$('#areaSubcuenta2').hide(500);
        	}
        });
    	$('#pagototal').click(function(){
    		if($("#pagototal").is(':checked')){
    			$("#sal_pre").val(parseFloat($("#pagototal").val()));  // checked
    		    $('#formularioPagar').data('formValidation').enableFieldValidators('sal_pre',true).revalidateField('sal_pre');
    		}else{
    			$("#sal_pre").val(0);  // unchecked
    		}
    	});
    	$('#devolucionTotal').click(function(){
    		if($("#devolucionTotal").is(':checked'))
    		    $("#montoDevolucion").val(parseFloat($("#devolucionTotal").val()));  // checked
    		else
    		    $("#montoDevolucion").val(0);  // unchecked
    	});
    	$('#checkDevolucion').click(function(){
    		if($("#checkDevolucion").is(':checked')){
    			$("#observacionDevolucion").val($("#checkDevolucion").val());  // checked
    			$('#formularioDevolver').data('formValidation').enableFieldValidators('observacionDevolucion',true).revalidateField('observacionDevolucion');
    		}
    	});
        $(".fecha").inputmask("dd/mm/yyyy", {
            "placeholder": "dd/mm/yyyy"
        });
        $(".hora").inputmask("hh:mm", {
            "placeholder": "hh:mm"
        });
        $('.select-chosen').chosen({
            no_results_text: "No se encuentra:",
            width: '100%'
        });
        var tablaPrestacion = $('#tabla').DataTable({
            buttons: [{
                text: 'Adicionar',
                className: "btn-primary btn-block active",
                action: function(e, dt, node, config) {
                	abrirLoad();
                    $.post('../prestacion/adicionar?isMobil='+UtilBrowser.isMobil(), function(resp) {
                        $('#contenedor').html(resp);
                        cerrarLoad();
                    });
                }
            }],
            "ajax": {
                "type": "POST",
                "url": "../prestacion/lista",
                "data": function(d) {
                    d.estado = $('input[name=estado]:checked').val();
                    d.fini = $('#fini').val();
                    d.ffin = $('#ffin').val();
                    d.usuario = $('input[name=usuario]:checked').val();
                    d.tipo = $('input[name=tipo]:checked').val();
                }
            },
            "columnDefs":[{targets:[14],className:"text-right"}],
            "columns": [{
                "data": "cod_pre"
            }, {
                "data": "entrega"
            }, {
                "data": "horent_pre"
            }, {
                "data": "estudiante"
            }, {
                "data": "estudiante"
            }, {
                "data": "ayudante"
            }, {
                "data": "xtipo"
            }, {
                "data": "docente"
            }, {
                "data": "fec_pre"
            }, {
                "data": "obs_pre"
            }, {
                "data": "telAyudante"
            }, {
                "data": "telEstudiante"
            }, {
                "data": "total"
            }, {
                "data": "totalDeuda"
            }, {
                "data": "cod_pre"
            }],
            "createdRow": function(row, data, index) {
            	$('td', row).eq(6).html('<span class="label label-info">'+data.xtipo+'</span>');
                let btnAction ='<button class="btn btn-success imprimir" title="Imprimir"><i class="glyphicon glyphicon-print"></i><br>ver</button>';
                if ($('input[name=estado]:checked').val() == 'true') {
                    if (data.tip_pre == 1 || data.tip_pre == 5) { //Pendiente y abandonado
                    	btnAction += '<button class="btn btn-warning cambiar" title="Cambiar"><i class="fa fa-edit"></i><br>editar</button>';
                    	btnAction += '<button class="btn btn-primary revisar" title="Revisar"><i class="fa fa-street-view"></i><br>revisar</button>';
                    	btnAction += '<button class="btn btn-danger eliminar" title="Eliminar"><i class="glyphicon glyphicon-remove"></i><br>eliminar</button>';
                    }
                    if(data.tip_pre ==3) {//incumplido
                    	btnAction += '<button class="btn btn-sm btn-primary revisar" title="Revisar"><i class="fa fa-street-view"></i><br>revisar</button>';
                    	btnAction += '<button class="btn btn-sm btn-default devolver" title="Devolver"><i class="fa fa-usd"></i><br>devolver dinero</button>';
                    }
                    if ((data.totalDeuda) > 0 && data.tip_pre != 6){
                    	btnAction += '<button class="btn btn-info pagar" title="Pagar saldo restante"><i class="fa fa-dollar"></i><br>pagar</button>';
                    } 
                    $('td', row).eq(14).html('<div class="btn-group-xs">' + btnAction + '</div>');
                } else {
                	btnAction += '<button class="btn btn-primary devolver" title="Devolver"><i class="fa fa-usd"></i><br>devolver dinero</button>';
                	$('td', row).eq(14).html(btnAction);
                }
                    
            },
            "drawCallback": function(settings) {
                $('.cambiar').click(function() {
                	let obj = tablaPrestacion.row($(this).closest('tr')).data();
                	obj.estudiante = obj.estudiante + ' (cel.'+(obj.telEstudiante||'')+')';
                	$('#formularioCambiar')[0].reset();
                    $('#formularioCambiar').loadJSON(obj);
                    // obj.fecent_pre = obj.entrega;
                    $('#dataCambio').loadJSON(obj);
                    
                    $('#formularioCambiar').loadJSON(obj);
                    $('#ayudante').val(obj.cod_ayu).trigger('chosen:updated');
                    $.post('../prestacion/obtenerDetalles?cod_pre=' + obj.cod_pre, function(resp){
                    	$('#tablaDetallesCambio > tbody').html('');
                    	$('#tablaDetallesCambio > tfoot').html('');
                    	if(resp.status){
                    		let total = 0;
                    		if(resp.data){
                    			resp.data.forEach(item =>{
                    				let tr= $('<tr></tr>');
                    				$('<td>'+item.servicio+'</td>').appendTo(tr);
                    				$('<td>'+item.nomTem+'</td>').appendTo(tr);
                    				$('<td class="w3-right-align">'+item.pre_detpre+'</td>').appendTo(tr);
                    				$('#tablaDetallesCambio > tbody:last').append(tr);
                    				total += item.pre_detpre;
                    			});
                    			let tr= $('<tr style="border-top: 3px solid black;"></tr>');
                				$('<td colspan="2" class="w3-right-align">SUBTOTAL'+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+total+'</td>').appendTo(tr);
                				$('#tablaDetallesCambio > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">DESCUENTO: '+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.des_pre+'</td>').appendTo(tr);
                				$('#tablaDetallesCambio > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">TOTAL A PAGAR: '+numeroALetras(obj.total)+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.total+'</td>').appendTo(tr);
                				$('#tablaDetallesCambio > tfoot:last').append(tr);
                    		}else{
                    			let tr= $('<tr><td colspan="3" class="w3-center">Sin datos</td></tr>');
                    		}
                    	}
                    	$('#modalCambiar').modal('show');
                    });
                });
                $('.eliminar').click(function() {
                	let obj = tablaPrestacion.row($(this).closest('tr')).data();
                	let xtable = '<table>';
                	xtable += '<tr>';
                	alertEliminacionHtml("Eliminacion de prestacion de servicio", xtable, function(){
        				jQuery.post('../prestacion/eliminar?cod_pre='+obj.cod_pre, function(resp){
        					if(resp.status){
        						$('#tabla').dataTable().fnDraw('page');
        						mostrarMensaje('success', resp.msg);
        					}else{
        						modalAlert('Error de eliminacion', resp.msg,'error');
        					}
        				});
        			});
                });
                $('.revisar').click(function() {
                	let obj = tablaPrestacion.row($(this).closest('tr')).data();
                	obj.estudiante = obj.estudiante + ' (cel.'+(obj.telEstudiante||'')+')';
                	$('#formularioRevisar')[0].reset();
                    $('#formularioRevisar').loadJSON(obj);
                    $('#dataRevisar').loadJSON(obj);
                    $.post('../prestacion/obtenerDetalles?cod_pre=' + obj.cod_pre, function(resp){
                    	$('#tablaDetallesRevisar > tbody').html('');
                    	$('#tablaDetallesRevisar > tfoot').html('');
                    	if(resp.status){
                    		let total = 0;
                    		if(resp.data){
                    			resp.data.forEach(item =>{
                    				let tr= $('<tr></tr>');
                    				$('<td>'+item.servicio+'</td>').appendTo(tr);
                    				$('<td>'+item.nomTem+'</td>').appendTo(tr);
                    				$('<td class="w3-right-align">'+item.pre_detpre+'</td>').appendTo(tr);
                    				$('#tablaDetallesRevisar > tbody:last').append(tr);
                    				total += item.pre_detpre;
                    			});
                				
                				let tr= $('<tr style="border-top: 3px solid black;"></tr>');
                				$('<td colspan="2" class="w3-right-align">SUBTOTAL'+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+total+'</td>').appendTo(tr);
                				$('#tablaDetallesRevisar > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">DESCUENTO: '+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.des_pre+'</td>').appendTo(tr);
                				$('#tablaDetallesRevisar > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">TOTAL A PAGAR: '+numeroALetras(obj.total)+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.total+'</td>').appendTo(tr);
                				$('#tablaDetallesRevisar > tfoot:last').append(tr);
                    		}else{
                    			let tr= $('<tr><td colspan="3" class="w3-center">Sin datos</td></tr>');
                    		}
                    	}
                    	$('#modalRevisar').modal('show');
                    });
                });
                $('.pagar').click(function() {
                	let obj = tablaPrestacion.row($(this).closest('tr')).data();
                	obj.estudiante = obj.estudiante + ' (cel.'+(obj.telEstudiante||'')+')';
                	$('#areaSubcuenta').hide();
                	$('#formularioPagar')[0].reset();
                    $('#formularioPagar').loadJSON(obj);
                    $('#sal_pre').val('');
                    $('#dataPago').loadJSON(obj);
                    $('#pagototal').val(obj.totalDeuda);
                    $('#codSubcuenta').val('').trigger('chosen:updated');
                    $.post('../prestacion/obtenerDetalles?cod_pre=' + obj.cod_pre, function(resp){
                    	$('#tablaDetallesPago > tbody').html('');
                    	$('#tablaDetallesPago > tfoot').html('');
                    	if(resp.status){
                    		let total = 0;
                    		if(resp.data){
                    			resp.data.forEach(item =>{
                    				let tr= $('<tr></tr>');
                    				$('<td>'+item.servicio+'</td>').appendTo(tr);
                    				$('<td>'+item.nomTem+'</td>').appendTo(tr);
                    				$('<td class="w3-right-align">'+item.pre_detpre+'</td>').appendTo(tr);
                    				$('#tablaDetallesPago > tbody:last').append(tr);
                    				total += item.pre_detpre;
                    			});

                				let tr= $('<tr style="border-top: 3px solid black;"></tr>');
                				$('<td colspan="2" class="w3-right-align">SUBTOTAL'+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+total+'</td>').appendTo(tr);
                				$('#tablaDetallesPago > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">DESCUENTO: '+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.des_pre+'</td>').appendTo(tr);
                				$('#tablaDetallesPago > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">TOTAL A PAGAR: '+numeroALetras(obj.total)+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.total+'</td>').appendTo(tr);
                				$('#tablaDetallesPago > tfoot:last').append(tr);
                    		}else{
                    			let tr= $('<tr><td colspan="3" class="w3-center">Sin datos</td></tr>');
                    		}
                    	}
                    	$('#modalPagar').modal('show');
                    });
                });
                $('.devolver').click(function() {
                	$('#areaSubcuenta2').hide();
                	let obj = tablaPrestacion.row($(this).closest('tr')).data();
                	obj.estudiante = obj.estudiante + ' (cel.'+(obj.telEstudiante||'')+')';
                	$('#formularioDevolver')[0].reset();
                    $('#formularioDevolver').loadJSON(obj);
                    $('#dataDevolucion').loadJSON(obj);
                    $('#devolucionTotal').val(obj.sal_pre);
                    $('#codSubcuenta2').val('').trigger('chosen:updated');
                    $('#checkDevolucion').val('Se realizo la devolucion del prestamo #'+obj.cod_pre+' al estudiante '+obj.estudiante);
                    $.post('../prestacion/obtenerDetalles?cod_pre=' + obj.cod_pre, function(resp){
                    	$('#tablaDetallesDevolucion > tbody').html('');
                    	$('#tablaDetallesDevolucion > tfoot').html('');
                    	if(resp.status){
                    		let total = 0;
                    		if(resp.data){
                    			resp.data.forEach(item =>{
                    				let tr= $('<tr></tr>');
                    				$('<td>'+item.servicio+'</td>').appendTo(tr);
                    				$('<td>'+item.nomTem+'</td>').appendTo(tr);
                    				$('<td class="w3-right-align">'+item.pre_detpre+'</td>').appendTo(tr);
                    				$('#tablaDetallesDevolucion > tbody:last').append(tr);
                    				total += item.pre_detpre;
                    			});

                				let tr= $('<tr style="border-top: 3px solid black;"></tr>');
                				$('<td colspan="2" class="w3-right-align">SUBTOTAL'+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+total+'</td>').appendTo(tr);
                				$('#tablaDetallesDevolucion > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">DESCUENTO: '+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.des_pre+'</td>').appendTo(tr);
                				$('#tablaDetallesDevolucion > tfoot:last').append(tr);
                				tr= $('<tr></tr>');
                				$('<td colspan="2" class="w3-right-align">TOTAL A PAGAR: '+numeroALetras(obj.total)+'</td>').appendTo(tr);
                				$('<td class="w3-right-align">'+obj.total+'</td>').appendTo(tr);
                				$('#tablaDetallesDevolucion > tfoot:last').append(tr);
                    		}else{
                    			let tr= $('<tr><td colspan="3" class="w3-center">Sin datos</td></tr>');
                    		}
                    	}
                    	$('#modalDevolver').modal('show');
                    });
                });
                $('.imprimir').click(function() {
                    	let obj = tablaPrestacion.row($(this).closest('tr')).data();
                    	obj.estudiante = obj.estudiante + ' (cel.'+(obj.telEstudiante||'')+')';
                    	dataPrestacion = obj; //Variable global seleccionada
                        $('#dataVer').loadJSON(obj);
                        $.post('../prestacion/obtenerDetalles?cod_pre=' + obj.cod_pre, function(resp){
                        	$('#tablaDetallesVer > tbody').html('');
                        	$('#tablaDetallesVer > tfoot').html('');
                        	if(resp.status){
                        		let total = 0;
                        		if(resp.data){
                        			resp.data.forEach(item =>{
                        				let tr= $('<tr></tr>');
                        				$('<td>'+item.servicio+'</td>').appendTo(tr);
                        				$('<td>'+item.nomTem+'</td>').appendTo(tr);
                        				$('<td class="w3-right-align">'+item.pre_detpre+'</td>').appendTo(tr);
                        				$('#tablaDetallesVer > tbody:last').append(tr);
                        				total += item.pre_detpre;
                        			});
                        			let tr= $('<tr style="border-top: 3px solid black;"></tr>');
                    				$('<td colspan="2" class="w3-right-align">SUBTOTAL'+'</td>').appendTo(tr);
                    				$('<td class="w3-right-align">'+total+'</td>').appendTo(tr);
                    				$('#tablaDetallesVer > tfoot:last').append(tr);
                    				tr= $('<tr></tr>');
                    				$('<td colspan="2" class="w3-right-align">DESCUENTO: '+'</td>').appendTo(tr);
                    				$('<td class="w3-right-align">'+obj.des_pre+'</td>').appendTo(tr);
                    				$('#tablaDetallesVer > tfoot:last').append(tr);
                    				tr= $('<tr></tr>');
                    				$('<td colspan="2" class="w3-right-align">TOTAL A PAGAR: '+numeroALetras(obj.total)+'</td>').appendTo(tr);
                    				$('<td class="w3-right-align">'+obj.total+'</td>').appendTo(tr);
                    				$('#tablaDetallesVer > tfoot:last').append(tr);
                        		}else{
                        			let tr= $('<tr><td colspan="3" class="w3-center">Sin datos</td></tr>');
                        		}
                        	}
                        	$('#modalVer').modal('show');
                        });
                });
                $('button[data-toggle="tooltip"]').tooltip({
                    animated: 'fade',
                    placement: 'bottom',
                });

            }
        });
        $('.estadoRadio').click(function() {
            $('#tabla').dataTable().fnDraw('page');
        });
        $('.tipoRadio').click(function() {
            $('#tabla').dataTable().fnDraw('page');
        });
        $('.usuarioRadio').click(function() {
            $('#tabla').dataTable().fnDraw('page');
        });

        function isDate(cad) {
            var d = new Date(cad.substring(3, 5) + '/' + cad.substring(0, 2) + '/' + cad.substring(6, 10));
            return !isNaN(d.valueOf());
        }
        $('#fini').keyup(function() {
            if (isDate($('#fini').val()))
                $('#tabla').dataTable().fnDraw('page');
        });
        $('#ffin').keyup(function() {
            if (isDate($('#ffin').val()))
                $('#tabla').dataTable().fnDraw('page');
        });
        $('#sal_pre').keyup(function() {
            var saldo = $(this).data('saldo');
            if (saldo < $(this).val()) {
                $(this).val('');
                mostrarMensaje('error', 'No se puede ingresar un monto mayor a el saldo restante');
            }
        });
        UtilDate.inputFormatData('fecent_pre',null,'entrega');
        $('#formulario,#formularioRevisar,#formularioCambiar').formValidation({
            locale: 'es_ES'
        }).on('success.form.fv', function(e) {
            e.preventDefault();
            var xform = $(e.target);
            alertAdicion('Confirmar transaccion', 'Esta seguro de realizar la transaccion?',function(){
            $.post(xform.attr('action'), xform.serialize(), function(result) {
                if (result.status == true) {
                    xform.data('formValidation').resetForm();
                    $('.modal').modal('hide');
                    $('#tabla').dataTable().fnDraw('page');
                    mostrarMensaje('info', result.msg);
                } else {
                	modalAlert('Error en la transaccion',result.msg,'error' );
                }
            }, 'json');
        });
        });
        $('#formularioPagar').formValidation({
            locale: 'es_ES'
        }).on('success.form.fv', function(e) {
            e.preventDefault();
            let formapago = parseInt($('input[name=formapago]:checked').val());
            if(formapago == 1){
            	let codSubcuenta = $('#codSubcuenta option:selected').val();
            	if(codSubcuenta == ''){
            		modalAlert('Validacion incorrecta', 'Seleccione una cuenta bancaria, si la forma de pago es por deposito bancario','error');
            		return;
            	}
            }
            alertAdicion('Confirmar transaccion', 'Esta seguro de realizar la transaccion?',function(){
            var xform = $(e.target);
            $.post(xform.attr('action'), xform.serialize(), function(result) {
                if (result.status == true) {
                    xform.data('formValidation').resetForm();
                    $('.modal').modal('hide');
                    $('#tabla').dataTable().fnDraw('page');
                    mostrarMensaje('info', result.msg);
                } else {
                	modalAlert('Error en la transaccion',result.msg,'error' );
                }
            }, 'json');
        });
        });
        $('#formularioDevolver').formValidation({
            locale: 'es_ES'
        }).on('success.form.fv', function(e) {
            e.preventDefault();
            let formapago = parseInt($('input[name=formapago2]:checked').val());
            if(formapago == 1){
            	let codSubcuenta = $('#codSubcuenta2 option:selected').val();
            	if(codSubcuenta == ''){
            		modalAlert('Validacion incorrecta', 'Seleccione una cuenta bancaria, si la forma de pago es por deposito bancario','error');
            		return;
            	}
            }
            alertAdicion('Confirmar transaccion', 'Esta seguro de realizar la transaccion?',function(){
            var xform = $(e.target);
            $.post(xform.attr('action'), xform.serialize(), function(result) {
                if (result.status == true) {
                    xform.data('formValidation').resetForm();
                    $('.modal').modal('hide');
                    $('#tabla').dataTable().fnDraw('page');
                    mostrarMensaje('info', result.msg);
                } else {
                	modalAlert('Error en la transaccion',result.msg,'error' );
                }
            }, 'json');
        });
        });
    });
</script>
</section>